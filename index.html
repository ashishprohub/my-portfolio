<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attack Mode - Personal Productivity Companion</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0a0a0f">
    <style>
        :root {
            --primary-bg: #0a0a0f;
            --secondary-bg: #111122;
            --card-bg: #1a1a2e;
            --card-bg-hover: #252543;
            --text-primary: #ffffff;
            --text-secondary: #a8a8b8;
            --accent-color: #6366f1;
            --accent-hover: #818cf8;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --border-color: #2d2d4a;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.4);
            --shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.6);
            --glow: 0 0 20px rgba(99, 102, 241, 0.3);
        }

        [data-theme="light"] {
            --primary-bg: #f8fafc;
            --secondary-bg: rgba(255, 255, 255, 0.9);
            --card-bg: rgba(255, 255, 255, 0.95);
            --card-bg-hover: rgba(248, 250, 252, 0.98);
            --text-primary: #1e293b;
            --text-secondary: #475569;
            --accent-color: #3b82f6;
            --accent-hover: #2563eb;
            --success-color: #059669;
            --warning-color: #d97706;
            --danger-color: #dc2626;
            --border-color: rgba(203, 213, 225, 0.8);
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            --shadow-hover: 0 20px 40px rgba(0, 0, 0, 0.12);
            --glow: 0 0 20px rgba(59, 130, 246, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--primary-bg);
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow-x: hidden;
        }

        /* Fixed Animated Background for Dark Theme */
        .animated-bg {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        /* Dark theme background */
        body:not([data-theme="light"]) .animated-bg {
            background: radial-gradient(circle at 20% 50%, rgba(99, 102, 241, 0.15) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, rgba(139, 92, 246, 0.12) 0%, transparent 50%),
                        radial-gradient(circle at 40% 80%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
                        linear-gradient(135deg, #0a0a0f 0%, #0f0f1a 50%, #1a1a2e 100%);
        }

        /* Light theme background */
        [data-theme="light"] .animated-bg {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 50%, #cbd5e1 100%);
        }

        [data-theme="light"] .animated-bg::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(59, 130, 246, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.04) 0%, transparent 50%),
                radial-gradient(circle at 50% 50%, rgba(139, 92, 246, 0.03) 0%, transparent 50%);
        }

        /* Coding Matrix Background for Light Theme Only */
        .coding-matrix {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            opacity: 0;
            font-family: 'Fira Code', monospace;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        [data-theme="light"] .coding-matrix {
            opacity: 0.12;
        }

        .code-line {
            position: absolute;
            white-space: nowrap;
            font-size: 14px;
            color: #3b82f6;
            animation: codeFlow 20s linear infinite;
            filter: blur(0.8px);
        }

        @keyframes codeFlow {
            0% {
                transform: translateX(-100%);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateX(100vw);
                opacity: 0;
            }
        }

        /* Fixed Floating Particles */
        .floating-particles {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        .particle {
            position: absolute;
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        /* Dark theme particles */
        body:not([data-theme="light"]) .particle {
            background: rgba(99, 102, 241, 0.2);
            box-shadow: 0 0 10px rgba(99, 102, 241, 0.3);
        }

        /* Light theme particles */
        [data-theme="light"] .particle {
            background: rgba(59, 130, 246, 0.15);
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.2);
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        /* Grid System for Desktop */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            flex: 1;
            position: relative;
            z-index: 1;
        }

        @media (min-width: 1200px) {
            .container {
                padding: 0 40px;
            }
        }

        /* Remove the invalid scoped keyframes and replace with: */

@keyframes pulse-dark {
    0% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(99, 102, 241, 0); }
    100% { box-shadow: 0 0 0 0 rgba(99, 102, 241, 0); }
}

@keyframes pulse-light {
    0% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(59, 130, 246, 0); }
    100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
}

@keyframes buttonGlow {
    0% { box-shadow: var(--shadow); }
    50% { box-shadow: var(--shadow), var(--glow); }
    100% { box-shadow: var(--shadow); }
}

/* Apply theme-specific animations */
.header h1 {
    font-size: 4rem;
    font-weight: 800;
    margin-bottom: 15px;
    background: linear-gradient(135deg, var(--accent-color), #06b6d4, #8b5cf6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    animation: pulse-dark 3s infinite;
}

[data-theme="light"] .header h1 {
    animation: pulse-light 3s infinite;
}

.calendar-day.today {
    background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
    color: white;
    font-weight: bold;
    box-shadow: var(--glow);
    animation: pulse-dark 2s infinite;
}

[data-theme="light"] .calendar-day.today {
    animation: pulse-light 2s infinite;
}


        .fade-in { animation: fadeIn 0.8s ease-out; }
        .slide-in-left { animation: slideInLeft 0.8s ease-out; }
        .scale-in { animation: scaleIn 0.8s ease-out; }

        /* Header */
        .header {
            text-align: center;
            padding: 60px 0;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 30px;
            right: 30px;
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            color: var(--text-primary);
            font-size: 14px;
            font-weight: 500;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .theme-toggle:hover {
            transform: scale(1.1) rotateY(10deg);
            box-shadow: var(--shadow-hover), var(--glow);
            background: var(--card-bg-hover);
        }

        .header h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 15px;
            background: linear-gradient(135deg, var(--accent-color), #06b6d4, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: pulse 3s infinite;
        }

        /* Dark theme text shadow */
        body:not([data-theme="light"]) .header h1 {
            text-shadow: 0 0 30px rgba(99, 102, 241, 0.4);
        }

        /* Light theme text shadow */
        [data-theme="light"] .header h1 {
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.2);
        }

        .header p {
            font-size: 1.3rem;
            color: var(--text-secondary);
            font-weight: 300;
        }

        /* Enhanced Cards - Fixed for both themes */
        .card {
            background: var(--card-bg);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        /* Dark theme card styling */
        body:not([data-theme="light"]) .card {
            background: linear-gradient(145deg, var(--card-bg), var(--secondary-bg));
        }

        /* Light theme card styling */
        [data-theme="light"] .card {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            transition: left 0.8s;
        }

        /* Dark theme card shimmer */
        body:not([data-theme="light"]) .card::before {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.05), transparent);
        }

        /* Light theme card shimmer */
        [data-theme="light"] .card::before {
            background: linear-gradient(90deg, transparent, rgba(59, 130, 246, 0.08), transparent);
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-8px) scale(1.02);
            box-shadow: var(--shadow-hover), var(--glow);
        }

        /* Dark theme card hover */
        body:not([data-theme="light"]) .card:hover {
            background: linear-gradient(145deg, var(--card-bg-hover), var(--card-bg));
        }

        /* Light theme card hover */
        [data-theme="light"] .card:hover {
            background: var(--card-bg-hover);
            box-shadow: var(--shadow-hover), var(--glow), 0 0 0 1px rgba(255, 255, 255, 0.2);
        }

        .card h2 {
            font-size: 1.8rem;
            margin-bottom: 20px;
            color: var(--text-primary);
            font-weight: 600;
        }

        .card h3 {
            font-size: 1.4rem;
            margin-bottom: 15px;
            color: var(--text-primary);
            font-weight: 600;
        }

        /* Desktop Grid Layout */
        .grid {
            display: grid;
            gap: 30px;
            margin-bottom: 30px;
        }

        .grid-2 { 
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); 
        }

        .grid-3 { 
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); 
        }

        .grid-4 {
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        }

        @media (min-width: 1200px) {
            .grid-2 {
                grid-template-columns: 1fr 1fr;
            }
            .grid-3 {
                grid-template-columns: 1fr 1fr 1fr;
            }
            .grid-4 {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        /* Quote Section - Fixed for both themes */
        .quote-section {
            text-align: center;
            font-style: italic;
            font-size: 1.2rem;
            color: var(--text-secondary);
            position: relative;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }

        /* Dark theme quote */
        body:not([data-theme="light"]) .quote-section {
            background: rgba(99, 102, 241, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.15);
        }

        /* Light theme quote */
        [data-theme="light"] .quote-section {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.15);
            backdrop-filter: blur(10px);
        }

        .quote-author {
            margin-top: 10px;
            font-weight: 600;
            color: var(--accent-color);
            font-size: 1rem;
        }

        /* Enhanced Stats - Fixed colors */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 20px;
        }

        @media (min-width: 1200px) {
            .stats-grid {
                grid-template-columns: repeat(5, 1fr);
            }
        }

        .stat-item {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        /* Dark theme stats */
        body:not([data-theme="light"]) .stat-item {
            background: linear-gradient(135deg, var(--secondary-bg), var(--card-bg));
        }

        /* Light theme stats */
        [data-theme="light"] .stat-item {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
        }

        .stat-item:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: var(--shadow-hover), var(--glow);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--accent-color);
        }

        /* Dark theme stat number glow */
        body:not([data-theme="light"]) .stat-number {
            text-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
        }

        /* Light theme stat number glow */
        [data-theme="light"] .stat-number {
            text-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 8px;
            font-weight: 500;
        }

        /* Enhanced Tasks - Fixed backgrounds */
        .task-item {
            display: flex;
            align-items: center;
            padding: 16px;
            margin-bottom: 12px;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        /* Dark theme task item */
        body:not([data-theme="light"]) .task-item {
            background: linear-gradient(135deg, var(--secondary-bg), rgba(99, 102, 241, 0.05));
        }

        /* Light theme task item */
        [data-theme="light"] .task-item {
            background: var(--card-bg);
            backdrop-filter: blur(15px);
        }

        .task-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            width: 4px;
            background: var(--accent-color);
            transform: scaleY(0);
            transition: transform 0.3s ease;
        }

        .task-item:hover::before {
            transform: scaleY(1);
        }

        .task-item:hover {
            transform: translateX(10px);
            box-shadow: var(--shadow), var(--glow);
        }

        /* Dark theme task hover */
        body:not([data-theme="light"]) .task-item:hover {
            background: linear-gradient(135deg, var(--card-bg), rgba(99, 102, 241, 0.1));
        }

        /* Light theme task hover */
        [data-theme="light"] .task-item:hover {
            background: var(--card-bg-hover);
            box-shadow: var(--shadow-hover), var(--glow);
        }

        .task-checkbox {
            margin-right: 15px;
            width: 22px;
            height: 22px;
            cursor: pointer;
            accent-color: var(--accent-color);
        }

        .task-content {
            flex: 1;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .task-text {
            flex: 1;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .task-completed .task-text {
            text-decoration: line-through;
            opacity: 0.6;
        }

        .priority-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .priority-high { 
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .priority-medium { 
            background: linear-gradient(135deg, var(--warning-color), #d97706);
            color: white;
            box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3);
        }

        [data-theme="light"] .priority-medium { 
            background: linear-gradient(135deg, var(--warning-color), #ea580c);
        }

        .priority-low { 
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        /* Enhanced Buttons - Fixed for both themes */
        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            border: none;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            position: relative;
            overflow: hidden;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            transition: left 0.5s;
        }

        /* Dark theme button shimmer */
        body:not([data-theme="light"]) .btn::before {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        /* Light theme button shimmer */
        [data-theme="light"] .btn::before {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            color: white;
        }

        /* Dark theme primary button */
        body:not([data-theme="light"]) .btn-primary {
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }

        /* Light theme primary button */
        [data-theme="light"] .btn-primary {
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px) scale(1.05);
            animation: buttonGlow 2s infinite;
        }

        /* Dark theme primary hover */
        body:not([data-theme="light"]) .btn-primary:hover {
            box-shadow: 0 15px 35px rgba(99, 102, 241, 0.4), var(--glow);
        }

        /* Light theme primary hover */
        [data-theme="light"] .btn-primary:hover {
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.4), var(--glow);
        }

        .btn-secondary {
            color: var(--text-primary);
            border: 2px solid var(--border-color);
        }

        /* Dark theme secondary button */
        body:not([data-theme="light"]) .btn-secondary {
            background: linear-gradient(135deg, var(--secondary-bg), var(--card-bg));
        }

        /* Light theme secondary button */
        [data-theme="light"] .btn-secondary {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
        }

        .btn-secondary:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: var(--shadow-hover);
            border-color: var(--accent-color);
        }

        /* Dark theme secondary hover */
        body:not([data-theme="light"]) .btn-secondary:hover {
            background: linear-gradient(135deg, var(--card-bg), var(--card-bg-hover));
        }

        /* Light theme secondary hover */
        [data-theme="light"] .btn-secondary:hover {
            background: var(--card-bg-hover);
            box-shadow: var(--shadow-hover), var(--glow);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger-color), #dc2626);
            color: white;
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }

        .btn-danger:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 35px rgba(239, 68, 68, 0.4);
        }

        /* Enhanced Modal - Fixed backgrounds */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000;
            animation: fadeIn 0.3s ease-out;
            backdrop-filter: blur(10px);
        }

        /* Dark theme modal backdrop */
        body:not([data-theme="light"]) .modal {
            background: rgba(0, 0, 0, 0.8);
        }

        /* Light theme modal backdrop */
        [data-theme="light"] .modal {
            background: rgba(0, 0, 0, 0.6);
        }

        .modal-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 35px;
            border-radius: 25px;
            width: 90%;
            max-width: 600px;
            max-height: 85vh;
            overflow-y: auto;
            animation: scaleIn 0.4s ease-out;
            box-shadow: var(--shadow-hover), var(--glow);
            border: 1px solid var(--border-color);
        }

        /* Dark theme modal content */
        body:not([data-theme="light"]) .modal-content {
            background: linear-gradient(145deg, var(--card-bg), var(--secondary-bg));
        }

        /* Light theme modal content */
        [data-theme="light"] .modal-content {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-hover), var(--glow), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .close {
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            color: var(--text-secondary);
            transition: all 0.3s ease;
            padding: 5px;
            border-radius: 50%;
        }

        .close:hover {
            color: var(--danger-color);
            background: rgba(239, 68, 68, 0.1);
            transform: rotate(90deg) scale(1.1);
        }

        /* Enhanced Form Elements */
        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 15px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            background: var(--secondary-bg);
            color: var(--text-primary);
            font-family: inherit;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        [data-theme="light"] .form-control {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 4px var(--glow);
            transform: scale(1.02);
        }

        /* Enhanced Calendar - Fixed colors */
        .calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
            margin-top: 20px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            align-items: center;
            padding: 12px;
            border-radius: 12px;
            border: 2px solid var(--border-color);
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }

        /* Dark theme calendar */
        body:not([data-theme="light"]) .calendar-day {
            background: linear-gradient(135deg, var(--secondary-bg), var(--card-bg));
        }

        /* Light theme calendar */
        [data-theme="light"] .calendar-day {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
        }

        .calendar-day:hover {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            color: white;
            transform: scale(1.1);
            box-shadow: var(--glow);
        }

        .calendar-day.today {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            color: white;
            font-weight: bold;
            box-shadow: var(--glow);
            animation: pulse 2s infinite;
        }

        .calendar-day.has-tasks {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
            box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);
        }

        /* Enhanced Pomodoro Timer */
        .timer-display {
            font-size: 4rem;
            font-weight: 800;
            text-align: center;
            color: var(--accent-color);
            margin: 30px 0;
            font-family: 'Courier New', monospace;
        }

        /* Dark theme timer */
        body:not([data-theme="light"]) .timer-display {
            text-shadow: 0 0 25px rgba(99, 102, 241, 0.6);
        }

        /* Light theme timer */
        [data-theme="light"] .timer-display {
            text-shadow: 0 0 20px rgba(59, 130, 246, 0.4);
        }

        .timer-controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-bottom: 25px;
            flex-wrap: wrap;
        }

        .timer-active {
            background: linear-gradient(135deg, var(--danger-color), #dc2626) !important;
            animation: pulse 2s infinite !important;
        }

        /* Enhanced Toast Notifications - Fixed */
        .toast {
            position: fixed;
            top: 30px;
            right: 30px;
            padding: 20px 30px;
            border-radius: 15px;
            box-shadow: var(--shadow-hover), var(--glow);
            border: 1px solid var(--border-color);
            z-index: 1001;
            animation: slideInLeft 0.5s ease-out;
            backdrop-filter: blur(10px);
            font-weight: 500;
            color: var(--text-primary);
        }

        /* Dark theme toast */
        body:not([data-theme="light"]) .toast {
            background: linear-gradient(135deg, var(--card-bg), var(--secondary-bg));
        }

        /* Light theme toast */
        [data-theme="light"] .toast {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-hover), var(--glow), 0 0 0 1px rgba(255, 255, 255, 0.1);
        }

        /* Enhanced Footer - Fixed */
        .footer {
            border-top: 2px solid var(--border-color);
            padding: 40px 0;
            text-align: center;
            color: var(--text-secondary);
            font-size: 1rem;
            margin-top: auto;
            position: relative;
            backdrop-filter: blur(10px);
        }

        /* Dark theme footer */
        body:not([data-theme="light"]) .footer {
            background: linear-gradient(135deg, var(--card-bg), var(--secondary-bg));
        }

        /* Light theme footer */
        [data-theme="light"] .footer {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
        }

        .footer::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .footer-links {
            display: flex;
            gap: 30px;
        }

        .footer-links a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .footer-links a:hover {
            color: var(--accent-color);
            transform: translateY(-2px);
        }

        .footer-social {
            display: flex;
            gap: 15px;
        }

        .social-icon {
            width: 40px;
            height: 40px;
            background: var(--secondary-bg);
            border: 2px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="light"] .social-icon {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
        }

        .social-icon:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-3px) rotate(10deg);
            box-shadow: var(--glow);
        }

        /* View Toggle - Fixed */
        .view-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .view-toggle button {
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            background: var(--secondary-bg);
            color: var(--text-primary);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            font-weight: 500;
        }

        [data-theme="light"] .view-toggle button {
            background: var(--card-bg);
            backdrop-filter: blur(10px);
        }

        .view-toggle button.active {
            background: linear-gradient(135deg, var(--accent-color), var(--accent-hover));
            color: white;
            border-color: var(--accent-color);
            box-shadow: var(--glow);
        }

        .view-toggle button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        /* Chart Container - Fixed */
        .chart-container {
            position: relative;
            height: 350px;
            margin-top: 25px;
            padding: 20px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }

        /* Dark theme chart */
        body:not([data-theme="light"]) .chart-container {
            background: rgba(99, 102, 241, 0.08);
            border: 1px solid rgba(99, 102, 241, 0.15);
        }

        /* Light theme chart */
        [data-theme="light"] .chart-container {
            background: rgba(59, 130, 246, 0.05);
            border: 1px solid rgba(59, 130, 246, 0.1);
            backdrop-filter: blur(10px);
        }

        /* Enhanced Responsive Design */
        @media (max-width: 768px) {
            .container {
                padding: 0 16px;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .timer-display {
                font-size: 2.5rem;
            }
            
            .theme-toggle {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 25px;
            }
            
            .modal-content {
                width: 95%;
                padding: 25px;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .footer-links {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .grid-2, .grid-3, .grid-4 {
                grid-template-columns: 1fr;
            }
            
            .timer-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
            
            .card {
                padding: 20px;
            }
        }

        /* Desktop specific enhancements */
        @media (min-width: 1200px) {
            .header {
                padding: 80px 0;
            }
            
            .header h1 {
                font-size: 5rem;
            }
            
            .card {
                padding: 40px;
            }
            
            .timer-display {
                font-size: 5rem;
            }
        }

        /* High resolution displays */
        @media (min-width: 1600px) {
            .container {
                max-width: 1600px;
            }
            
            .header h1 {
                font-size: 6rem;
            }
        }
    </style>
</head>
<body>
    <!-- Animated Background -->
    <div class="animated-bg">
        <div class="coding-matrix" id="coding-matrix"></div>
        <div class="floating-particles" id="particles"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header fade-in">
            <button class="theme-toggle" onclick="toggleTheme()">üåô Dark Mode</button>
            <h1>Attack Mode</h1>
            <p>My personal productivity companion - Level up your productivity game!</p>
        </header>

        <!-- Motivational Quote -->
        <div class="card slide-in-left">
            <div class="quote-section" id="quote-section">
                <div id="daily-quote">"The way to get started is to quit talking and begin doing."</div>
                <div class="quote-author" id="quote-author">- Walt Disney</div>
            </div>
        </div>

        <!-- Stats Card -->
        <div class="card scale-in">
            <h2>üìä Your Progress Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number" id="tasks-today">0</div>
                    <div class="stat-label">Today</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="tasks-week">0</div>
                    <div class="stat-label">This Week</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="tasks-month">0</div>
                    <div class="stat-label">This Month</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="completion-rate">0%</div>
                    <div class="stat-label">Completion Rate</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number" id="longest-streak">0</div>
                    <div class="stat-label">Longest Streak</div>
                </div>
            </div>
        </div>

        <!-- Task Management -->
        <div class="grid grid-2">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h3>üìã Today's Goals</h3>
                    <button class="btn btn-primary" onclick="openAddTaskModal()">
                        <span>‚ûï Add Task</span>
                    </button>
                </div>
                <div id="today-tasks"></div>
            </div>
            
            <div class="card">
                <h3>üìÖ Upcoming Tasks</h3>
                <div class="view-toggle">
                    <button id="list-view-btn" class="active" onclick="setView('list')">üìù List View</button>
                    <button id="calendar-view-btn" onclick="setView('calendar')">üìÖ Calendar View</button>
                </div>
                <div id="upcoming-tasks"></div>
                <div id="calendar-view" style="display: none;">
                    <div class="calendar" id="calendar"></div>
                </div>
            </div>
        </div>

        <!-- Pomodoro Timer & Productivity Chart -->
        <div class="grid grid-2">
            <div class="card">
                <h3>üçÖ Pomodoro Focus Timer</h3>
                <div class="timer-display" id="timer-display">25:00</div>
                <div class="timer-controls">
                    <button class="btn btn-primary" id="timer-start" onclick="startTimer()">‚ñ∂Ô∏è Start Focus</button>
                    <button class="btn btn-secondary" id="timer-pause" onclick="pauseTimer()">‚è∏Ô∏è Pause</button>
                    <button class="btn btn-secondary" onclick="resetTimer()">üîÑ Reset</button>
                </div>
            </div>

            <div class="card">
                <h3>üìà Productivity Chart</h3>
                <div class="chart-container">
                    <canvas id="productivityChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Action Center -->
        <div class="card">
            <h3>‚öôÔ∏è Action Center</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                <button class="btn btn-secondary" onclick="openTaskHistoryModal()">
                    üìö Task History
                </button>
                <button class="btn btn-secondary" onclick="exportTasks()">
                    üíæ Export Tasks
                </button>
                <button class="btn btn-secondary" onclick="document.getElementById('import-file').click()">
                    üì• Import Tasks
                </button>
                <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importTasks(event)">
            </div>
        </div>
    </div>

    <!-- Enhanced Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div>
                    <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: var(--accent-color);">
                        ‚ö° Attack Mode
                    </div>
                    <div>¬© 2025 as_hi_sh_ | Built with ‚ù§Ô∏è by Ashish | All rights reserved.</div>
                </div>
                
                <div class="footer-links">
                    <a href="#" onclick="showToast('Privacy policy coming soon! üìã')">Privacy Policy</a>
                    <a href="#" onclick="showToast('Terms of service coming soon! üìÑ')">Terms of Service</a>
                    <a href="#" onclick="showToast('Contact form coming soon! üìû')">Contact</a>
                </div>
                
                <div class="footer-social">
                    <a href="#" class="social-icon" onclick="showToast('GitHub link coming soon! üîó')" title="GitHub">
                        <span>üêô</span>
                    </a>
                    <a href="#" class="social-icon" onclick="showToast('Twitter link coming soon! üîó')" title="Twitter">
                        <span>üê¶</span>
                    </a>
                    <a href="#" class="social-icon" onclick="showToast('LinkedIn link coming soon! üîó')" title="LinkedIn">
                        <span>üíº</span>
                    </a>
                </div>
            </div>
            
            <div style="margin-top: 30px; padding-top: 20px; border-top: 1px solid var(--border-color); font-size: 0.9rem; color: var(--text-secondary);">
                üöÄ Boost your productivity with Attack Mode - Where goals become achievements!
            </div>
        </div>
    </footer>

    <!-- Add/Edit Task Modal -->
    <div id="task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">‚ú® Add New Task</h2>
                <span class="close" onclick="closeModal('task-modal')">&times;</span>
            </div>
            <form id="task-form">
                <div class="form-group">
                    <label for="task-description">üìù Task Description</label>
                    <input type="text" id="task-description" class="form-control" placeholder="What do you want to accomplish?" required>
                </div>
                <div class="form-group">
                    <label for="task-priority">‚ö° Priority Level</label>
                    <select id="task-priority" class="form-control">
                        <option value="low">üü¢ Low Priority</option>
                        <option value="medium" selected>üü° Medium Priority</option>
                        <option value="high">üî¥ High Priority</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="task-date">üìÖ Schedule Date (Optional)</label>
                    <input type="date" id="task-date" class="form-control">
                </div>
                <div style="display: flex; gap: 15px; justify-content: flex-end; margin-top: 30px;">
                    <button type="button" class="btn btn-secondary" onclick="closeModal('task-modal')">‚ùå Cancel</button>
                    <button type="submit" class="btn btn-primary">üíæ Save Task</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Task History Modal -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìö Task History</h2>
                <span class="close" onclick="closeModal('history-modal')">&times;</span>
            </div>
            <div id="task-history"></div>
        </div>
    </div>

    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
        // Global Variables
        let tasks = JSON.parse(localStorage.getItem('attackmode-tasks')) || [];
        let currentEditingTask = null;
        let timerInterval = null;
        let timerMinutes = 25;
        let timerSeconds = 0;
        let timerRunning = false;
        let currentView = 'list';
        let productivityChart = null;

        // Coding snippets for background animation
        const codingSnippets = [
            'function attack() { productivity++; }',
            'while(goals.length > 0) { achieve(goals.pop()); }',
            'const success = hardWork * consistency;',
            'if(motivated) { takeAction(); }',
            'for(let i = 0; i < dreams.length; i++) { makeItReality(dreams[i]); }',
            'productivity.map(task => task.complete());',
            'const result = await focus.maximize();',
            'setInterval(() => { improve(); }, 1000);',
            'export default class Achiever { constructor() { this.unstoppable = true; } }',
            'git commit -m "Another step closer to success"',
            'npm install determination confidence',
            'console.log("Attack Mode: Activated");',
            'const power = discipline * habits;',
            'setTimeout(() => { celebrate(); }, goal.timeToComplete);',
            'React.useState(motivated)[1](true);'
        ];

        // Motivational Quotes
        const quotes = [
            { text: "The way to get started is to quit talking and begin doing.", author: "Walt Disney" },
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "The only impossible journey is the one you never begin.", author: "Tony Robbins" },
            { text: "Don't be afraid to give up the good to go for the great.", author: "John D. Rockefeller" },
            { text: "The future depends on what you do today.", author: "Mahatma Gandhi" },
            { text: "It is during our darkest moments that we must focus to see the light.", author: "Aristotle" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "Your limitation‚Äîit's only your imagination.", author: "Unknown" },
            { text: "Push yourself, because no one else is going to do it for you.", author: "Unknown" },
            { text: "Great things never come from comfort zones.", author: "Unknown" }
        ];

        // Initialize App
        document.addEventListener('DOMContentLoaded', function() {
            loadTheme();
            createFloatingParticles();
            createCodingMatrix();
            displayDailyQuote();
            updateStats();
            renderTasks();
            renderCalendar();
            setupKeyboardShortcuts();
            checkDailyNotification();
            initProductivityChart();
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js');
            }
        });

        // Create Floating Particles - Fixed for both themes
        function createFloatingParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 15;
            
            // Clear existing particles
            particlesContainer.innerHTML = '';
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                // Random size
                const size = Math.random() * 6 + 2;
                particle.style.width = size + 'px';
                particle.style.height = size + 'px';
                
                // Random horizontal position
                particle.style.left = Math.random() * 100 + '%';
                
                // Random animation delay and duration
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 15 + 15) + 's';
                
                particlesContainer.appendChild(particle);
            }
        }

        // Create Coding Matrix Background (Light Theme Only)
        function createCodingMatrix() {
            const matrixContainer = document.getElementById('coding-matrix');
            
            function addCodeLine() {
                // Only add code lines in light theme
                if (document.documentElement.getAttribute('data-theme') === 'light') {
                    const codeLine = document.createElement('div');
                    codeLine.className = 'code-line';
                    codeLine.textContent = codingSnippets[Math.floor(Math.random() * codingSnippets.length)];
                    
                    // Random vertical position
                    codeLine.style.top = Math.random() * 100 + '%';
                    
                    // Random animation delay
                    codeLine.style.animationDelay = '0s';
                    codeLine.style.animationDuration = (Math.random() * 10 + 15) + 's';
                    
                    matrixContainer.appendChild(codeLine);
                    
                    // Remove after animation
                    setTimeout(() => {
                        if (matrixContainer.contains(codeLine)) {
                            matrixContainer.removeChild(codeLine);
                        }
                    }, 25000);
                }
            }
            
            // Clear existing code lines when switching to dark theme
            if (document.documentElement.getAttribute('data-theme') !== 'light') {
                matrixContainer.innerHTML = '';
            } else {
                // Add new code line every 3 seconds in light theme
                setInterval(addCodeLine, 3000);
                
                // Add initial code lines
                for (let i = 0; i < 5; i++) {
                    setTimeout(addCodeLine, i * 1000);
                }
            }
        }

        // Theme Toggle - Fixed
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('attackmode-theme', newTheme);
            
            const toggle = document.querySelector('.theme-toggle');
            toggle.innerHTML = newTheme === 'light' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
            
            showToast(`Switched to ${newTheme} theme! ‚ú®`);
            
            // Recreate particles for proper theming
            createFloatingParticles();
            
            // Handle coding matrix
            if (newTheme === 'light') {
                setTimeout(() => {
                    createCodingMatrix();
                }, 500);
            } else {
                // Clear coding matrix in dark theme
                document.getElementById('coding-matrix').innerHTML = '';
            }
            
            // Update chart colors
            if (productivityChart) {
                updateProductivityChart();
            }
        }

        function loadTheme() {
            const savedTheme = localStorage.getItem('attackmode-theme') || 'dark';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const toggle = document.querySelector('.theme-toggle');
            toggle.innerHTML = savedTheme === 'light' ? '‚òÄÔ∏è Light Mode' : 'üåô Dark Mode';
        }

        // Daily Quote
        function displayDailyQuote() {
            const today = new Date().toDateString();
            const savedQuoteDate = localStorage.getItem('attackmode-quote-date');
            
            if (savedQuoteDate !== today) {
                const randomQuote = quotes[Math.floor(Math.random() * quotes.length)];
                localStorage.setItem('attackmode-daily-quote', JSON.stringify(randomQuote));
                localStorage.setItem('attackmode-quote-date', today);
            }
            
            const dailyQuote = JSON.parse(localStorage.getItem('attackmode-daily-quote')) || quotes[0];
            document.getElementById('daily-quote').textContent = `"${dailyQuote.text}"`;
            document.getElementById('quote-author').textContent = `- ${dailyQuote.author}`;
        }

        // Task Management
        function openAddTaskModal() {
            currentEditingTask = null;
            document.getElementById('modal-title').textContent = '‚ú® Add New Task';
            document.getElementById('task-form').reset();
            document.getElementById('task-modal').style.display = 'block';
            setTimeout(() => document.getElementById('task-description').focus(), 100);
        }

        function openEditTaskModal(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            currentEditingTask = taskId;
            document.getElementById('modal-title').textContent = '‚úèÔ∏è Edit Task';
            document.getElementById('task-description').value = task.description;
            document.getElementById('task-priority').value = task.priority;
            document.getElementById('task-date').value = task.scheduledDate || '';
            document.getElementById('task-modal').style.display = 'block';
            setTimeout(() => document.getElementById('task-description').focus(), 100);
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Task Form Submission
        document.getElementById('task-form').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const description = document.getElementById('task-description').value.trim();
            const priority = document.getElementById('task-priority').value;
            const scheduledDate = document.getElementById('task-date').value;
            
            if (!description) {
                showToast('Please enter a task description! üìù', 'error');
                return;
            }
            
            if (currentEditingTask) {
                // Edit existing task
                const taskIndex = tasks.findIndex(t => t.id === currentEditingTask);
                if (taskIndex !== -1) {
                    tasks[taskIndex].description = description;
                    tasks[taskIndex].priority = priority;
                    tasks[taskIndex].scheduledDate = scheduledDate;
                    tasks[taskIndex].updatedAt = new Date().toISOString();
                }
                showToast('Task updated successfully! ‚úÖ');
            } else {
                // Add new task
                const newTask = {
                    id: Date.now().toString(),
                    description,
                    priority,
                    completed: false,
                    createdAt: new Date().toISOString(),
                    scheduledDate: scheduledDate || null,
                    completedAt: null
                };
                tasks.unshift(newTask);
                showToast('New task added! Let\'s attack it! üöÄ');
            }
            
            saveTasks();
            renderTasks();
            renderCalendar();
            updateStats();
            closeModal('task-modal');
        });

        function toggleTask(taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (!task) return;
            
            task.completed = !task.completed;
            task.completedAt = task.completed ? new Date().toISOString() : null;
            
            saveTasks();
            renderTasks();
            updateStats();
            updateProductivityChart();
            
            if (task.completed) {
                showToast('üéâ Task completed! You\'re on fire!');
                createCelebration();
            } else {
                showToast('Task marked as incomplete üìù');
            }
        }

        function deleteTask(taskId) {
            if (confirm('Are you sure you want to delete this task? This action cannot be undone.')) {
                tasks = tasks.filter(t => t.id !== taskId);
                saveTasks();
                renderTasks();
                renderCalendar();
                updateStats();
                showToast('Task deleted successfully! üóëÔ∏è');
            }
        }

        function renderTasks() {
            const today = new Date().toDateString();
            const todayTasks = tasks.filter(task => {
                const taskDate = task.scheduledDate ? new Date(task.scheduledDate).toDateString() : new Date(task.createdAt).toDateString();
                return taskDate === today;
            }).sort((a, b) => {
                if (a.completed !== b.completed) return a.completed - b.completed;
                const priorityOrder = { high: 3, medium: 2, low: 1 };
                return priorityOrder[b.priority] - priorityOrder[a.priority];
            });
            
            const upcomingTasks = tasks.filter(task => {
                if (!task.scheduledDate) return false;
                const taskDate = new Date(task.scheduledDate).toDateString();
                return taskDate > today;
            }).sort((a, b) => new Date(a.scheduledDate) - new Date(b.scheduledDate));
            
            renderTaskList('today-tasks', todayTasks, 'No tasks for today! Add one to get started! üöÄ');
            
            if (currentView === 'list') {
                renderTaskList('upcoming-tasks', upcomingTasks, 'No upcoming tasks scheduled. Plan ahead! üìÖ');
            }
        }

        function renderTaskList(containerId, taskList, emptyMessage) {
            const container = document.getElementById(containerId);
            
            if (taskList.length === 0) {
                container.innerHTML = `<p style="color: var(--text-secondary); text-align: center; padding: 30px; font-style: italic;">${emptyMessage}</p>`;
                return;
            }
            
            container.innerHTML = taskList.map(task => `
                <div class="task-item ${task.completed ? 'task-completed' : ''}" data-task-id="${task.id}">
                    <input type="checkbox" class="task-checkbox" ${task.completed ? 'checked' : ''} onchange="toggleTask('${task.id}')">
                    <div class="task-content">
                        <span class="task-text">${task.description}</span>
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                            <button class="btn btn-secondary" style="padding: 6px 12px; font-size: 0.8rem;" onclick="openEditTaskModal('${task.id}')" title="Edit Task">
                                ‚úèÔ∏è
                            </button>
                            <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8rem;" onclick="deleteTask('${task.id}')" title="Delete Task">
                                üóëÔ∏è
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Calendar View
        function setView(view) {
            currentView = view;
            
            document.getElementById('list-view-btn').classList.toggle('active', view === 'list');
            document.getElementById('calendar-view-btn').classList.toggle('active', view === 'calendar');
            
            if (view === 'list') {
                document.getElementById('upcoming-tasks').style.display = 'block';
                document.getElementById('calendar-view').style.display = 'none';
                renderTasks();
            } else {
                document.getElementById('upcoming-tasks').style.display = 'none';
                document.getElementById('calendar-view').style.display = 'block';
                renderCalendar();
            }
        }

        function renderCalendar() {
            const calendar = document.getElementById('calendar');
            const today = new Date();
            const currentMonth = today.getMonth();
            const currentYear = today.getFullYear();
            
            // Get first day of month and number of days
            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();
            
            calendar.innerHTML = '';
            
            // Add day headers
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            dayHeaders.forEach(day => {
                const header = document.createElement('div');
                header.textContent = day;
                header.style.fontWeight = '700';
                header.style.textAlign = 'center';
                header.style.padding = '12px';
                header.style.background = 'linear-gradient(135deg, var(--accent-color), var(--accent-hover))';
                header.style.color = 'white';
                header.style.borderRadius = '12px';
                header.style.fontSize = '0.9rem';
                header.style.textTransform = 'uppercase';
                header.style.letterSpacing = '1px';
                calendar.appendChild(header);
            });
            
            // Add empty cells for days before month starts
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day';
                emptyDay.style.opacity = '0.3';
                emptyDay.style.cursor = 'default';
                calendar.appendChild(emptyDay);
            }
            
            // Add days of month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                dayElement.textContent = day;
                
                const currentDate = new Date(currentYear, currentMonth, day);
                const dateString = currentDate.toDateString();
                
                // Check if today
                if (dateString === today.toDateString()) {
                    dayElement.classList.add('today');
                }
                
                // Check if has tasks
                const dayTasks = tasks.filter(task => {
                    if (!task.scheduledDate) return false;
                    return new Date(task.scheduledDate).toDateString() === dateString;
                });
                
                if (dayTasks.length > 0) {
                    dayElement.classList.add('has-tasks');
                    dayElement.title = `${dayTasks.length} task(s) scheduled`;
                    const badge = document.createElement('div');
                    badge.textContent = dayTasks.length;
                    badge.style.position = 'absolute';
                    badge.style.bottom = '4px';
                    badge.style.right = '4px';
                    badge.style.background = 'var(--warning-color)';
                    badge.style.color = 'white';
                    badge.style.borderRadius = '50%';
                    badge.style.width = '16px';
                    badge.style.height = '16px';
                    badge.style.fontSize = '10px';
                    badge.style.display = 'flex';
                    badge.style.alignItems = 'center';
                    badge.style.justifyContent = 'center';
                    badge.style.fontWeight = 'bold';
                    dayElement.style.position = 'relative';
                    dayElement.appendChild(badge);
                }
                
                calendar.appendChild(dayElement);
            }
        }

        // Statistics
        function updateStats() {
            const today = new Date();
            const startOfWeek = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay());
            const startOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
            
            const tasksToday = tasks.filter(task => {
                const taskDate = task.completedAt ? new Date(task.completedAt) : new Date(task.createdAt);
                return taskDate.toDateString() === today.toDateString() && task.completed;
            }).length;
            
            const tasksThisWeek = tasks.filter(task => {
                if (!task.completed) return false;
                const taskDate = new Date(task.completedAt);
                return taskDate >= startOfWeek;
            }).length;
            
            const tasksThisMonth = tasks.filter(task => {
                if (!task.completed) return false;
                const taskDate = new Date(task.completedAt);
                return taskDate >= startOfMonth;
            }).length;
            
            const completedTasks = tasks.filter(t => t.completed).length;
            const totalTasks = tasks.length;
            const completionRate = totalTasks > 0 ? Math.round((completedTasks / totalTasks) * 100) : 0;
            
            const streak = calculateStreak();
            
            // Animate numbers
            animateNumber('tasks-today', tasksToday);
            animateNumber('tasks-week', tasksThisWeek);
            animateNumber('tasks-month', tasksThisMonth);
            animateNumber('completion-rate', completionRate, '%');
            animateNumber('longest-streak', streak);
        }

        function animateNumber(elementId, targetValue, suffix = '') {
            const element = document.getElementById(elementId);
            const currentValue = parseInt(element.textContent) || 0;
            const increment = targetValue > currentValue ? 1 : -1;
            const duration = 1000; // 1 second
            const steps = Math.abs(targetValue - currentValue);
            const stepTime = steps > 0 ? duration / steps : 0;
            
            let current = currentValue;
            const timer = setInterval(() => {
                current += increment;
                element.textContent = current + suffix;
                
                if (current === targetValue) {
                    clearInterval(timer);
                }
            }, stepTime);
        }

        function calculateStreak() {
            const completedDates = tasks
                .filter(task => task.completed && task.completedAt)
                .map(task => new Date(task.completedAt).toDateString())
                .sort();
            
            if (completedDates.length === 0) return 0;
            
            let currentStreak = 1;
            let maxStreak = 1;
            
            for (let i = 1; i < completedDates.length; i++) {
                const prevDate = new Date(completedDates[i - 1]);
                const currentDate = new Date(completedDates[i]);
                const dayDiff = (currentDate - prevDate) / (1000 * 60 * 60 * 24);
                
                if (dayDiff === 1) {
                    currentStreak++;
                    maxStreak = Math.max(maxStreak, currentStreak);
                } else {
                    currentStreak = 1;
                }
            }
            
            return maxStreak;
        }

        // Pomodoro Timer
        function startTimer() {
            if (!timerRunning) {
                timerRunning = true;
                document.body.classList.add('timer-active');
                document.getElementById('timer-start').innerHTML = '‚è∏Ô∏è Pause';
                
                timerInterval = setInterval(updateTimer, 1000);
                showToast('üçÖ Pomodoro session started! Focus time!');
            } else {
                pauseTimer();
            }
        }

        function pauseTimer() {
            timerRunning = false;
            clearInterval(timerInterval);
            document.body.classList.remove('timer-active');
            document.getElementById('timer-start').innerHTML = '‚ñ∂Ô∏è Resume';
            showToast('Timer paused. Take a breath! üòå');
        }

        function resetTimer() {
            timerRunning = false;
            clearInterval(timerInterval);
            timerMinutes = 25;
            timerSeconds = 0;
            updateTimerDisplay();
            document.body.classList.remove('timer-active');
            document.getElementById('timer-start').innerHTML = '‚ñ∂Ô∏è Start Focus';
            showToast('Timer reset to 25 minutes! üîÑ');
        }

        function updateTimer() {
            if (timerSeconds === 0) {
                if (timerMinutes === 0) {
                    // Timer finished
                    timerRunning = false;
                    clearInterval(timerInterval);
                    document.body.classList.remove('timer-active');
                    document.getElementById('timer-start').innerHTML = '‚ñ∂Ô∏è Start Focus';
                    showToast('üéâ Pomodoro session completed! Take a 5-minute break!');
                    
                    // Play notification sound (if available)
                    if (window.AudioContext || window.webkitAudioContext) {
                        playNotificationSound();
                    }
                    
                    resetTimer();
                    return;
                }
                timerMinutes--;
                timerSeconds = 59;
            } else {
                timerSeconds--;
            }
            updateTimerDisplay();
        }

        function updateTimerDisplay() {
            const display = document.getElementById('timer-display');
            const minutes = timerMinutes.toString().padStart(2, '0');
            const seconds = timerSeconds.toString().padStart(2, '0');
            display.textContent = `${minutes}:${seconds}`;
            
            // Update page title
            if (timerRunning) {
                document.title = `${minutes}:${seconds} - Attack Mode`;
            } else {
                document.title = 'Attack Mode - Personal Productivity Companion';
            }
        }

        function playNotificationSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0, audioContext.currentTime);
            gainNode.gain.linearRampToValueAtTime(0.3, audioContext.currentTime + 0.1);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 1);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 1);
        }

        // Task History
        function openTaskHistoryModal() {
            const historyContainer = document.getElementById('task-history');
            
            if (tasks.length === 0) {
                historyContainer.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 40px; font-style: italic;">No tasks in history yet. Start being productive! üöÄ</p>';
            } else {
                const sortedTasks = [...tasks].sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                
                historyContainer.innerHTML = sortedTasks.map(task => `
                    <div class="task-item ${task.completed ? 'task-completed' : ''}" style="margin-bottom: 15px;">
                        <div class="task-content">
                            <div>
                                <span class="task-text">${task.description}</span>
                                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 6px;">
                                    üìÖ Created: ${new Date(task.createdAt).toLocaleDateString('en-US', { 
                                        weekday: 'short', 
                                        year: 'numeric', 
                                        month: 'short', 
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}
                                    ${task.completedAt ? ` | ‚úÖ Completed: ${new Date(task.completedAt).toLocaleDateString('en-US', { 
                                        weekday: 'short', 
                                        year: 'numeric', 
                                        month: 'short', 
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}` : ' | ‚è≥ Pending'}
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="priority-badge priority-${task.priority}">${task.priority}</span>
                                <button class="btn btn-danger" style="padding: 6px 12px; font-size: 0.8rem;" onclick="deleteTask('${task.id}'); closeModal('history-modal');" title="Delete Task">
                                    üóëÔ∏è
                                </button>
                            </div>
                        </div>
                    </div>
                `).join('');
            }
            
            document.getElementById('history-modal').style.display = 'block';
        }

        // Export/Import
        function exportTasks() {
            const exportData = {
                tasks: tasks,
                exportDate: new Date().toISOString(),
                version: '2.0',
                totalTasks: tasks.length,
                completedTasks: tasks.filter(t => t.completed).length
            };
            
            const dataStr = JSON.stringify(exportData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `attack-mode-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showToast('üìÅ Tasks exported successfully! Backup saved!');
        }

        function importTasks(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importData = JSON.parse(e.target.result);
                    const importedTasks = importData.tasks || importData; // Support both new and old formats
                    
                    if (!Array.isArray(importedTasks)) {
                        throw new Error('Invalid file format');
                    }
                    
                    if (confirm(`üì• Import ${importedTasks.length} tasks? This will merge with your existing ${tasks.length} tasks.`)) {
                        // Add unique IDs to avoid conflicts
                        const tasksWithNewIds = importedTasks.map(task => ({
                            ...task,
                            id: Date.now().toString() + Math.random().toString(36).substr(2, 9)
                        }));
                        
                        tasks = [...tasks, ...tasksWithNewIds];
                        saveTasks();
                        renderTasks();
                        renderCalendar();
                        updateStats();
                        updateProductivityChart();
                        showToast(`‚úÖ Successfully imported ${importedTasks.length} tasks! Welcome back!`);
                    }
                } catch (error) {
                    showToast('‚ùå Error importing tasks. Please check the file format.', 'error');
                    console.error('Import error:', error);
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Productivity Chart - Fixed for both themes
        function initProductivityChart() {
            const ctx = document.getElementById('productivityChart').getContext('2d');
            const last7Days = getLast7DaysData();
            
            const isLightTheme = document.documentElement.getAttribute('data-theme') === 'light';
            
            productivityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: last7Days.map(d => d.date),
                    datasets: [{
                        label: 'Tasks Completed',
                        data: last7Days.map(d => d.count),
                        backgroundColor: isLightTheme ? 'rgba(59, 130, 246, 0.8)' : 'rgba(99, 102, 241, 0.8)',
                        borderColor: isLightTheme ? 'rgba(59, 130, 246, 1)' : 'rgba(99, 102, 241, 1)',
                        borderWidth: 2,
                        borderRadius: 12,
                        borderSkipped: false,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            labels: {
                                color: isLightTheme ? 'rgba(30, 41, 59, 0.8)' : 'rgba(255, 255, 255, 0.8)',
                                font: {
                                    family: 'Inter',
                                    weight: '600'
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: {
                                color: isLightTheme ? 'rgba(30, 41, 59, 0.6)' : 'rgba(255, 255, 255, 0.6)',
                                font: {
                                    family: 'Inter'
                                }
                            },
                            grid: {
                                color: isLightTheme ? 'rgba(30, 41, 59, 0.1)' : 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1,
                                color: isLightTheme ? 'rgba(30, 41, 59, 0.6)' : 'rgba(255, 255, 255, 0.6)',
                                font: {
                                    family: 'Inter'
                                }
                            },
                            grid: {
                                color: isLightTheme ? 'rgba(30, 41, 59, 0.1)' : 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    animation: {
                        duration: 2000,
                        easing: 'easeInOutQuart'
                    }
                }
            });
        }

        function updateProductivityChart() {
            if (productivityChart) {
                const last7Days = getLast7DaysData();
                const isLightTheme = document.documentElement.getAttribute('data-theme') === 'light';
                
                productivityChart.data.labels = last7Days.map(d => d.date);
                productivityChart.data.datasets[0].data = last7Days.map(d => d.count);
                productivityChart.data.datasets[0].backgroundColor = isLightTheme ? 'rgba(59, 130, 246, 0.8)' : 'rgba(99, 102, 241, 0.8)';
                productivityChart.data.datasets[0].borderColor = isLightTheme ? 'rgba(59, 130, 246, 1)' : 'rgba(99, 102, 241, 1)';
                
                // Update legend and axis colors
                productivityChart.options.plugins.legend.labels.color = isLightTheme ? 'rgba(30, 41, 59, 0.8)' : 'rgba(255, 255, 255, 0.8)';
                productivityChart.options.scales.x.ticks.color = isLightTheme ? 'rgba(30, 41, 59, 0.6)' : 'rgba(255, 255, 255, 0.6)';
                productivityChart.options.scales.y.ticks.color = isLightTheme ? 'rgba(30, 41, 59, 0.6)' : 'rgba(255, 255, 255, 0.6)';
                productivityChart.options.scales.x.grid.color = isLightTheme ? 'rgba(30, 41, 59, 0.1)' : 'rgba(255, 255, 255, 0.1)';
                productivityChart.options.scales.y.grid.color = isLightTheme ? 'rgba(30, 41, 59, 0.1)' : 'rgba(255, 255, 255, 0.1)';
                
                productivityChart.update('active');
            }
        }

        function getLast7DaysData() {
            const days = [];
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                const dateString = date.toDateString();
                
                const completedTasks = tasks.filter(task => {
                    if (!task.completed || !task.completedAt) return false;
                    return new Date(task.completedAt).toDateString() === dateString;
                }).length;
                
                days.push({
                    date: date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }),
                    count: completedTasks
                });
            }
            return days;
        }

        // Keyboard Shortcuts
        function setupKeyboardShortcuts() {
            document.addEventListener('keydown', function(e) {
                // Don't trigger shortcuts when typing in inputs
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'SELECT') {
                    return;
                }
                
                if (e.ctrlKey && e.key === 'n' && !e.shiftKey) {
                    e.preventDefault();
                    openAddTaskModal();
                } else if (e.ctrlKey && e.shiftKey && e.key === 'N') {
                    e.preventDefault();
                    openAddTaskModal();
                    setTimeout(() => document.getElementById('task-date').focus(), 200);
                } else if (e.key === 'Escape') {
                    closeModal('task-modal');
                    closeModal('history-modal');
                } else if (e.ctrlKey && e.key === 'h') {
                    e.preventDefault();
                    openTaskHistoryModal();
                } else if (e.key === ' ' && !e.target.closest('.modal')) {
                    e.preventDefault();
                    if (timerRunning) {
                        pauseTimer();
                    } else {
                        startTimer();
                    }
                }
            });
        }

        // Daily Notification
        function checkDailyNotification() {
            const now = new Date();
            const ninePM = new Date();
            ninePM.setHours(21, 0, 0, 0);
            
            if (now >= ninePM) {
                const today = now.toDateString();
                const tasksCompletedToday = tasks.filter(task => {
                    if (!task.completed) return false;
                    return new Date(task.completedAt).toDateString() === today;
                }).length;
                
                if (tasksCompletedToday === 0) {
                    setTimeout(() => {
                        showToast('üì¢ Daily Reminder: You haven\'t completed any tasks today. Time to get into Attack Mode! üöÄ', 'warning');
                    }, 3000);
                }
            }
        }

        // Toast Notifications - Fixed
        function showToast(message, type = 'success') {
            // Remove existing toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            
            if (type === 'error') {
                toast.style.background = 'linear-gradient(135deg, var(--danger-color), #dc2626)';
                toast.style.color = 'white';
                toast.style.border = '1px solid var(--danger-color)';
            } else if (type === 'warning') {
                toast.style.background = 'linear-gradient(135deg, var(--warning-color), #d97706)';
                toast.style.color = 'white';
                toast.style.border = '1px solid var(--warning-color)';
            }
            
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    if (document.body.contains(toast)) {
                        document.body.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }

        // Storage
        function saveTasks() {
            localStorage.setItem('attackmode-tasks', JSON.stringify(tasks));
        }

        // Close modals when clicking outside
        window.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });

        // Celebration effect when task is completed
        function createCelebration() {
            const colors = ['#6366f1', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b'];
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.top = '0px';
                    confetti.style.borderRadius = '50%';
                    confetti.style.pointerEvents = 'none';
                    confetti.style.zIndex = '9999';
                    confetti.style.animation = 'confetti-fall 3s linear forwards';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        if (document.body.contains(confetti)) {
                            document.body.removeChild(confetti);
                        }
                    }, 3000);
                }, i * 100);
            }
        }

        // Add confetti animation CSS
        const confettiStyle = document.createElement('style');
        confettiStyle.textContent = `
            @keyframes confetti-fall {
                0% {
                    transform: translateY(0px) rotate(0deg);
                    opacity: 1;
                }
                100% {
                    transform: translateY(100vh) rotate(720deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(confettiStyle);

        // Service Worker for PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(err) {
                        console.log('ServiceWorker registration failed');
                    });
            });
        }
    </script>

    <!-- Service Worker Code -->
    <script>
        // Simple Service Worker for PWA
        const swCode = `
            const CACHE_NAME = 'attack-mode-v2';
            const urlsToCache = [
                '/',
                '/manifest.json',
                'https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@300;400;500&display=swap',
                'https://cdn.jsdelivr.net/npm/chart.js'
            ];

            self.addEventListener('install', function(event) {
                event.waitUntil(
                    caches.open(CACHE_NAME)
                        .then(function(cache) {
                            return cache.addAll(urlsToCache);
                        })
                );
            });

            self.addEventListener('fetch', function(event) {
                event.respondWith(
                    caches.match(event.request)
                        .then(function(response) {
                            return response || fetch(event.request);
                        })
                );
            });

            self.addEventListener('activate', function(event) {
                event.waitUntil(
                    caches.keys().then(function(cacheNames) {
                        return Promise.all(
                            cacheNames.map(function(cacheName) {
                                if (cacheName !== CACHE_NAME) {
                                    return caches.delete(cacheName);
                                }
                            })
                        );
                    })
                );
            });
        `;

        // Create service worker file
        const swBlob = new Blob([swCode], { type: 'application/javascript' });
        const swUrl = URL.createObjectURL(swBlob);

        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register(swUrl)
                .then(registration => console.log('SW registered'))
                .catch(error => console.log('SW registration failed'));
        }

        // Enhanced PWA Manifest
        const manifest = {
            name: "Attack Mode - Productivity Companion",
            short_name: "AttackMode",
            description: "Your ultimate personal productivity companion",
            start_url: "/",
            display: "standalone",
            background_color: "#0a0a0f",
            theme_color: "#6366f1",
            orientation: "portrait-primary",
            categories: ["productivity", "lifestyle", "utilities"],
            lang: "en",
            icons: [
                {
                    src: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMwYTBhMGYiLz4KPHN2ZyB4PSI0OCIgeT0iNDgiIHdpZHRoPSI5NiIgaGVpZ2h0PSI5NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSIjNjM2NmYxIj4KPHBhdGggZD0iTTEyIDJMMTMuMDkgOC4yNkwyMCA5TDEzLjA5IDE1Ljc0TDEyIDIyTDEwLjkxIDE1Ljc0TDQgOUwxMC45MSA4LjI2TDEyIDJaIi8+Cjwvc3ZnPgo8L3N2Zz4=",
                    sizes: "192x192",
                    type: "image/svg+xml"
                }
            ]
        };

        const manifestBlob = new Blob([JSON.stringify(manifest, null, 2)], { type: 'application/json' });
        const manifestUrl = URL.createObjectURL(manifestBlob);
        
        const manifestLink = document.createElement('link');
        manifestLink.rel = 'manifest';
        manifestLink.href = manifestUrl;
        document.head.appendChild(manifestLink);
    </script>
</body>
</html>
